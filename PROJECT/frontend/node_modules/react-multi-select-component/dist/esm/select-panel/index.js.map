{"version":3,"sources":["../../../src/select-panel/index.tsx"],"names":["React","useCallback","useEffect","useMemo","useRef","useState","useKey","useMultiSelect","KEY","debounce","filterOptions","Cross","SelectItem","SelectList","FocusType","SelectPanel","t","onChange","options","setOptions","value","customFilterOptions","ItemRenderer","disabled","disableSearch","hasSelectAll","ClearIcon","debounceDuration","isCreatable","onCreateOption","listRef","searchInputRef","searchText","setSearchText","filteredOptions","setFilteredOptions","searchTextForFilter","setSearchTextForFilter","focusIndex","setFocusIndex","debouncedSearch","query","skipIndex","start","selectAllOption","label","selectAllValues","checked","filteredValues","filter","o","map","selectedValues","finalSelectedValues","includes","selectAllChanged","newOptions","handleSearchChange","e","target","SEARCH","handleClear","current","focus","handleItemClicked","index","handleKeyDown","code","ARROW_UP","updateFocus","ARROW_DOWN","stopPropagation","preventDefault","handleSearchFocus","handleOnCreateOption","newOption","__isNew__","getFilteredOptions","offset","newFocus","Math","max","min","length","querySelector","isAllOptionSelected","hasSelectableOptions","filteredOptionsList","every","findIndex","v","then","_e"],"mappings":"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","sourcesContent":["/**\n * This component represents the entire panel which gets dropped down when the\n * user selects the component.  It encapsulates the search filter, the\n * Select-all item, and the list of options.\n */\nimport React, {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\n\nimport { useKey } from \"../hooks/use-key\";\nimport { useMultiSelect } from \"../hooks/use-multi-select\";\nimport { KEY } from \"../lib/constants\";\nimport { debounce } from \"../lib/debounce\";\nimport { filterOptions } from \"../lib/fuzzy-match-utils\";\nimport { Cross } from \"./cross\";\nimport SelectItem from \"./select-item\";\nimport SelectList from \"./select-list\";\n\nenum FocusType {\n  SEARCH = 0,\n  NONE = -1,\n}\n\nconst SelectPanel = () => {\n  const {\n    t,\n    onChange,\n    options,\n    setOptions,\n    value,\n    filterOptions: customFilterOptions,\n    ItemRenderer,\n    disabled,\n    disableSearch,\n    hasSelectAll,\n    ClearIcon,\n    debounceDuration,\n    isCreatable,\n    onCreateOption,\n  } = useMultiSelect();\n\n  const listRef = useRef<any>();\n  const searchInputRef = useRef<any>();\n  const [searchText, setSearchText] = useState(\"\");\n  const [filteredOptions, setFilteredOptions] = useState(options);\n  const [searchTextForFilter, setSearchTextForFilter] = useState(\"\");\n  const [focusIndex, setFocusIndex] = useState(0);\n  const debouncedSearch = useCallback(\n    debounce((query) => setSearchTextForFilter(query), debounceDuration),\n    []\n  );\n\n  const skipIndex = useMemo(() => {\n    let start = 0;\n\n    if (!disableSearch) start += 1; // if search is enabled then +1 to skipIndex\n    if (hasSelectAll) start += 1; // if select-all is enabled then +1 to skipIndex\n\n    return start;\n  }, [disableSearch, hasSelectAll]);\n\n  const selectAllOption = {\n    label: searchText ? t(\"selectAllFiltered\") : t(\"selectAll\"),\n    value: \"\",\n  };\n\n  const selectAllValues = (checked) => {\n    const filteredValues = filteredOptions\n      .filter((o) => !o.disabled)\n      .map((o) => o.value);\n\n    if (checked) {\n      const selectedValues = value.map((o) => o.value);\n      const finalSelectedValues = [...selectedValues, ...filteredValues];\n\n      return options.filter((o) => finalSelectedValues.includes(o.value));\n    }\n\n    return value.filter((o) => !filteredValues.includes(o.value));\n  };\n\n  const selectAllChanged = (checked: boolean) => {\n    const newOptions = selectAllValues(checked);\n    onChange(newOptions);\n  };\n\n  const handleSearchChange = (e) => {\n    debouncedSearch(e.target.value);\n    setSearchText(e.target.value);\n    setFocusIndex(FocusType.SEARCH);\n  };\n\n  const handleClear = () => {\n    setSearchTextForFilter(\"\");\n    setSearchText(\"\");\n    searchInputRef?.current?.focus();\n  };\n\n  const handleItemClicked = (index: number) => setFocusIndex(index);\n\n  // Arrow Key Navigation\n  const handleKeyDown = (e) => {\n    switch (e.code) {\n      case KEY.ARROW_UP:\n        updateFocus(-1);\n        break;\n      case KEY.ARROW_DOWN:\n        updateFocus(1);\n        break;\n      default:\n        return;\n    }\n    e.stopPropagation();\n    e.preventDefault();\n  };\n\n  useKey([KEY.ARROW_DOWN, KEY.ARROW_UP], handleKeyDown, {\n    target: listRef,\n  });\n\n  const handleSearchFocus = () => {\n    setFocusIndex(FocusType.SEARCH);\n  };\n\n  const handleOnCreateOption = async () => {\n    let newOption = { label: searchText, value: searchText, __isNew__: true };\n\n    // if custom `onCreateOption` is given then this will call this\n    if (onCreateOption) {\n      newOption = await onCreateOption(searchText);\n    }\n\n    // adds created value to existing options\n    setOptions([newOption, ...options]);\n    handleClear();\n\n    onChange([...value, newOption]);\n  };\n\n  const getFilteredOptions = async () =>\n    customFilterOptions\n      ? await customFilterOptions(options, searchTextForFilter)\n      : filterOptions(options, searchTextForFilter);\n\n  const updateFocus = (offset: number) => {\n    let newFocus = focusIndex + offset;\n    newFocus = Math.max(0, newFocus);\n    newFocus = Math.min(newFocus, options.length + Math.max(skipIndex - 1, 0));\n    setFocusIndex(newFocus);\n  };\n\n  useEffect(() => {\n    listRef?.current?.querySelector(`[tabIndex='${focusIndex}']`)?.focus();\n  }, [focusIndex]);\n\n  const [isAllOptionSelected, hasSelectableOptions] = useMemo(() => {\n    const filteredOptionsList = filteredOptions.filter((o) => !o.disabled);\n    return [\n      filteredOptionsList.every(\n        (o) => value.findIndex((v) => v.value === o.value) !== -1\n      ),\n      filteredOptionsList.length !== 0,\n    ];\n    // eslint-disable-next-line\n  }, [filteredOptions, value]);\n\n  useEffect(() => {\n    getFilteredOptions().then(setFilteredOptions);\n  }, [searchTextForFilter, options]);\n\n  return (\n    <div className=\"select-panel\" role=\"listbox\" ref={listRef}>\n      {!disableSearch && (\n        <div className=\"search\">\n          <input\n            placeholder={t(\"search\")}\n            type=\"text\"\n            aria-describedby={t(\"search\")}\n            onChange={handleSearchChange}\n            onFocus={handleSearchFocus}\n            value={searchText}\n            ref={searchInputRef}\n            tabIndex={0}\n          />\n          <button\n            type=\"button\"\n            className=\"search-clear-button\"\n            hidden={!searchText}\n            onClick={handleClear}\n            aria-label={t(\"clearSearch\")}\n          >\n            {ClearIcon || <Cross />}\n          </button>\n        </div>\n      )}\n\n      <ul className=\"options\">\n        {hasSelectAll && hasSelectableOptions && (\n          <SelectItem\n            tabIndex={skipIndex === 1 ? 0 : 1}\n            checked={isAllOptionSelected}\n            option={selectAllOption}\n            onSelectionChanged={selectAllChanged}\n            onClick={() => handleItemClicked(1)}\n            itemRenderer={ItemRenderer}\n            disabled={disabled}\n          />\n        )}\n\n        {filteredOptions.length ? (\n          <SelectList\n            skipIndex={skipIndex}\n            options={filteredOptions}\n            onClick={(_e, index) => handleItemClicked(index)}\n          />\n        ) : isCreatable ? (\n          <li onClick={handleOnCreateOption} className=\"select-item creatable\">\n            {`${t(\"create\")} \"${searchText}\"`}\n          </li>\n        ) : (\n          <li className=\"no-options\">{t(\"noOptions\")}</li>\n        )}\n      </ul>\n    </div>\n  );\n};\n\nexport default SelectPanel;\n"],"file":"index.js"}