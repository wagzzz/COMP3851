{"version":3,"sources":["../../../src/select-panel/index.tsx"],"names":["FocusType","SelectPanel","t","onChange","options","setOptions","value","filterOptions","customFilterOptions","ItemRenderer","disabled","disableSearch","hasSelectAll","ClearIcon","debounceDuration","isCreatable","onCreateOption","listRef","searchInputRef","searchText","setSearchText","filteredOptions","setFilteredOptions","searchTextForFilter","setSearchTextForFilter","focusIndex","setFocusIndex","debouncedSearch","query","skipIndex","start","selectAllOption","label","selectAllValues","checked","filteredValues","filter","o","map","selectedValues","finalSelectedValues","includes","selectAllChanged","newOptions","handleSearchChange","e","target","SEARCH","handleClear","current","focus","handleItemClicked","index","handleKeyDown","code","KEY","ARROW_UP","updateFocus","ARROW_DOWN","stopPropagation","preventDefault","handleSearchFocus","handleOnCreateOption","newOption","__isNew__","getFilteredOptions","offset","newFocus","Math","max","min","length","querySelector","isAllOptionSelected","hasSelectableOptions","filteredOptionsList","every","findIndex","v","then","_e"],"mappings":"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","sourcesContent":["/**\n * This component represents the entire panel which gets dropped down when the\n * user selects the component.  It encapsulates the search filter, the\n * Select-all item, and the list of options.\n */\nimport React, {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\n\nimport { useKey } from \"../hooks/use-key\";\nimport { useMultiSelect } from \"../hooks/use-multi-select\";\nimport { KEY } from \"../lib/constants\";\nimport { debounce } from \"../lib/debounce\";\nimport { filterOptions } from \"../lib/fuzzy-match-utils\";\nimport { Cross } from \"./cross\";\nimport SelectItem from \"./select-item\";\nimport SelectList from \"./select-list\";\n\nenum FocusType {\n  SEARCH = 0,\n  NONE = -1,\n}\n\nconst SelectPanel = () => {\n  const {\n    t,\n    onChange,\n    options,\n    setOptions,\n    value,\n    filterOptions: customFilterOptions,\n    ItemRenderer,\n    disabled,\n    disableSearch,\n    hasSelectAll,\n    ClearIcon,\n    debounceDuration,\n    isCreatable,\n    onCreateOption,\n  } = useMultiSelect();\n\n  const listRef = useRef<any>();\n  const searchInputRef = useRef<any>();\n  const [searchText, setSearchText] = useState(\"\");\n  const [filteredOptions, setFilteredOptions] = useState(options);\n  const [searchTextForFilter, setSearchTextForFilter] = useState(\"\");\n  const [focusIndex, setFocusIndex] = useState(0);\n  const debouncedSearch = useCallback(\n    debounce((query) => setSearchTextForFilter(query), debounceDuration),\n    []\n  );\n\n  const skipIndex = useMemo(() => {\n    let start = 0;\n\n    if (!disableSearch) start += 1; // if search is enabled then +1 to skipIndex\n    if (hasSelectAll) start += 1; // if select-all is enabled then +1 to skipIndex\n\n    return start;\n  }, [disableSearch, hasSelectAll]);\n\n  const selectAllOption = {\n    label: searchText ? t(\"selectAllFiltered\") : t(\"selectAll\"),\n    value: \"\",\n  };\n\n  const selectAllValues = (checked) => {\n    const filteredValues = filteredOptions\n      .filter((o) => !o.disabled)\n      .map((o) => o.value);\n\n    if (checked) {\n      const selectedValues = value.map((o) => o.value);\n      const finalSelectedValues = [...selectedValues, ...filteredValues];\n\n      return options.filter((o) => finalSelectedValues.includes(o.value));\n    }\n\n    return value.filter((o) => !filteredValues.includes(o.value));\n  };\n\n  const selectAllChanged = (checked: boolean) => {\n    const newOptions = selectAllValues(checked);\n    onChange(newOptions);\n  };\n\n  const handleSearchChange = (e) => {\n    debouncedSearch(e.target.value);\n    setSearchText(e.target.value);\n    setFocusIndex(FocusType.SEARCH);\n  };\n\n  const handleClear = () => {\n    setSearchTextForFilter(\"\");\n    setSearchText(\"\");\n    searchInputRef?.current?.focus();\n  };\n\n  const handleItemClicked = (index: number) => setFocusIndex(index);\n\n  // Arrow Key Navigation\n  const handleKeyDown = (e) => {\n    switch (e.code) {\n      case KEY.ARROW_UP:\n        updateFocus(-1);\n        break;\n      case KEY.ARROW_DOWN:\n        updateFocus(1);\n        break;\n      default:\n        return;\n    }\n    e.stopPropagation();\n    e.preventDefault();\n  };\n\n  useKey([KEY.ARROW_DOWN, KEY.ARROW_UP], handleKeyDown, {\n    target: listRef,\n  });\n\n  const handleSearchFocus = () => {\n    setFocusIndex(FocusType.SEARCH);\n  };\n\n  const handleOnCreateOption = async () => {\n    let newOption = { label: searchText, value: searchText, __isNew__: true };\n\n    // if custom `onCreateOption` is given then this will call this\n    if (onCreateOption) {\n      newOption = await onCreateOption(searchText);\n    }\n\n    // adds created value to existing options\n    setOptions([newOption, ...options]);\n    handleClear();\n\n    onChange([...value, newOption]);\n  };\n\n  const getFilteredOptions = async () =>\n    customFilterOptions\n      ? await customFilterOptions(options, searchTextForFilter)\n      : filterOptions(options, searchTextForFilter);\n\n  const updateFocus = (offset: number) => {\n    let newFocus = focusIndex + offset;\n    newFocus = Math.max(0, newFocus);\n    newFocus = Math.min(newFocus, options.length + Math.max(skipIndex - 1, 0));\n    setFocusIndex(newFocus);\n  };\n\n  useEffect(() => {\n    listRef?.current?.querySelector(`[tabIndex='${focusIndex}']`)?.focus();\n  }, [focusIndex]);\n\n  const [isAllOptionSelected, hasSelectableOptions] = useMemo(() => {\n    const filteredOptionsList = filteredOptions.filter((o) => !o.disabled);\n    return [\n      filteredOptionsList.every(\n        (o) => value.findIndex((v) => v.value === o.value) !== -1\n      ),\n      filteredOptionsList.length !== 0,\n    ];\n    // eslint-disable-next-line\n  }, [filteredOptions, value]);\n\n  useEffect(() => {\n    getFilteredOptions().then(setFilteredOptions);\n  }, [searchTextForFilter, options]);\n\n  return (\n    <div className=\"select-panel\" role=\"listbox\" ref={listRef}>\n      {!disableSearch && (\n        <div className=\"search\">\n          <input\n            placeholder={t(\"search\")}\n            type=\"text\"\n            aria-describedby={t(\"search\")}\n            onChange={handleSearchChange}\n            onFocus={handleSearchFocus}\n            value={searchText}\n            ref={searchInputRef}\n            tabIndex={0}\n          />\n          <button\n            type=\"button\"\n            className=\"search-clear-button\"\n            hidden={!searchText}\n            onClick={handleClear}\n            aria-label={t(\"clearSearch\")}\n          >\n            {ClearIcon || <Cross />}\n          </button>\n        </div>\n      )}\n\n      <ul className=\"options\">\n        {hasSelectAll && hasSelectableOptions && (\n          <SelectItem\n            tabIndex={skipIndex === 1 ? 0 : 1}\n            checked={isAllOptionSelected}\n            option={selectAllOption}\n            onSelectionChanged={selectAllChanged}\n            onClick={() => handleItemClicked(1)}\n            itemRenderer={ItemRenderer}\n            disabled={disabled}\n          />\n        )}\n\n        {filteredOptions.length ? (\n          <SelectList\n            skipIndex={skipIndex}\n            options={filteredOptions}\n            onClick={(_e, index) => handleItemClicked(index)}\n          />\n        ) : isCreatable ? (\n          <li onClick={handleOnCreateOption} className=\"select-item creatable\">\n            {`${t(\"create\")} \"${searchText}\"`}\n          </li>\n        ) : (\n          <li className=\"no-options\">{t(\"noOptions\")}</li>\n        )}\n      </ul>\n    </div>\n  );\n};\n\nexport default SelectPanel;\n"],"file":"index.js"}